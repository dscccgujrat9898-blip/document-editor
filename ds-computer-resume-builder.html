<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DS Computer Resume Builder</title>

  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1b34;
      --txt:#e9f0ff;
      --muted:#a9b7d0;
      --line:rgba(255,255,255,.10);
      --btn:#2b5cff;
      --btn2:#1b2a4a;
      --danger:#ff4d4d;

      --a4w:210mm;
      --a4h:297mm;
      --pad:12mm;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{
      margin:0;
      background:radial-gradient(1200px 600px at 20% 0%,#14264a 0%,#0b1220 55%,#070b14 100%);
      color:var(--txt);
    }
    header{
      position:sticky;top:0;z-index:20;
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      background:rgba(11,18,32,.92);
      backdrop-filter: blur(8px);
      display:flex;gap:12px;align-items:center;justify-content:space-between;
    }
    header .title{display:flex;flex-direction:column;gap:2px}
    header h1{margin:0;font-size:16px;letter-spacing:.2px}
    header p{margin:0;color:var(--muted);font-size:12px}

    .wrap{
      display:grid;
      grid-template-columns: 470px 1fr;
      gap:14px;
      padding:14px;
      max-width:1550px;
      margin:0 auto;
    }
    .panel{
      background:rgba(15,27,52,.72);
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
    }
    .panel .head{
      padding:12px 12px;
      border-bottom:1px solid var(--line);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .panel .head b{font-size:13px}
    .panel .body{padding:12px}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input, textarea, select{
      width:100%;
      padding:10px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(10,16,32,.55);
      color:var(--txt);
      outline:none;
    }
    textarea{min-height:84px;resize:vertical}
    select{cursor:pointer}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{
      border:0;
      padding:10px 12px;
      border-radius:12px;
      color:white;
      background:var(--btn);
      cursor:pointer;
      font-weight:600;
      font-size:13px;
    }
    button.secondary{background:var(--btn2);border:1px solid var(--line)}
    button.danger{background:var(--danger)}
    .hint{color:var(--muted);font-size:12px;line-height:1.4}
    .divider{margin:12px 0;height:1px;background:var(--line)}

    .chipbox{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      background:rgba(10,16,32,.35);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:8px 10px;
    }
    .chip{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--txt)}
    .chip input{width:auto;transform:scale(1.05)}

    .previewWrap{
      padding:12px;
      background:rgba(15,27,52,.38);
      border:1px solid var(--line);
      border-radius:14px;
      overflow:auto;
      min-height:calc(100vh - 96px);
    }

    .pages{display:flex;flex-direction:column;gap:14px;align-items:center}
    .page{
      width:var(--a4w);
      height:var(--a4h);
      background:white;
      color:#111;
      border-radius:10px;
      box-shadow:0 18px 50px rgba(0,0,0,.35);
      overflow:hidden;
      position:relative;
    }
    .page .content{height:100%;padding:var(--pad)}

    /* Common resume text */
    .r-hdr{display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
    .r-name{margin:0;font-weight:900;line-height:1.05}
    .r-role{margin:6px 0 0;color:#333;font-weight:700}
    .r-contact{font-size:11.5px;color:#333;line-height:1.45;text-align:right;max-width:46%;word-break:break-word}
    .section{margin:10px 0 0}
    .section p,.section li{font-size:12px;color:#222;line-height:1.55;margin:0}
    ul{margin:0;padding-left:18px}
    .twoCol{display:grid;grid-template-columns: 1.2fr .8fr;gap:14px}
    .pillRow{display:flex;flex-wrap:wrap;gap:6px}
    .pill{font-size:11px;border:1px solid #d9d9d9;padding:4px 8px;border-radius:999px;background:#fafafa}
    .kv{display:grid;grid-template-columns: 120px 1fr;gap:6px 10px}
    .kv b{font-size:12px;color:#111}
    .kv div{font-size:12px;color:#222}

    /* Styles (templates like your images) */
    .styleA .r-name{font-size:30px;letter-spacing:.4px}
    .styleA .r-role{font-size:13px}
    .styleA .topLine{height:1px;background:#111;margin:10px 0 8px;opacity:.25}
    .styleA .h3{font-size:12px;letter-spacing:.7px;text-transform:uppercase;margin:0 0 6px}
    .styleA .rule{height:1px;background:#111;opacity:.18;margin:8px 0 10px}

    .styleB .r-name{font-size:28px;color:#0b3c6f}
    .styleB .bar{background:#0b3c6f;color:#fff;padding:6px 10px;border-radius:4px;
      font-size:12px;font-weight:800;letter-spacing:.6px;text-transform:uppercase;margin:12px 0 8px}
    .styleB .sub{font-size:12px;color:#222;line-height:1.55}

    .styleC .r-name{font-size:28px}
    .styleC .headRule{height:2px;background:#111;opacity:.2;margin:8px 0 12px}
    .styleC .h3{font-size:12px;letter-spacing:.7px;text-transform:uppercase;margin:0 0 6px}
    .styleC .shade{background:#f2f2f2;padding:8px;border-radius:6px;border:1px solid #e5e5e5}

    .styleD .r-name{font-size:26px}
    .styleD .boxH{display:inline-block;border:2px solid #111;padding:4px 8px;font-size:12px;
      font-weight:900;letter-spacing:.6px;text-transform:uppercase;margin:12px 0 8px}
    .styleD .thin{height:1px;background:#111;opacity:.15;margin:10px 0}

    /* Pagination */
    .block{break-inside:avoid; page-break-inside:avoid}

    /* Print */
    @page{size:A4;margin:0}
    @media print{
      body{background:white}
      header,.panel{display:none!important}
      .wrap{display:block;padding:0;margin:0}
      .previewWrap{border:0;padding:0;min-height:auto}
      .pages{gap:0}
      .page{box-shadow:none;border-radius:0;width:210mm;height:297mm;page-break-after:always}
      .page:last-child{page-break-after:auto}
    }
    @media (max-width: 1150px){
      .wrap{grid-template-columns:1fr}
      .previewWrap{min-height:auto}
    }

    /* Custom sections UI */
    .secCard{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      background:rgba(10,16,32,.35);
      margin-top:10px;
    }
    .secCard .top{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .secCard .top b{font-size:12px}
    .secCard .miniBtn{
      padding:6px 10px;border-radius:10px;font-size:12px
    }
  </style>
</head>

<body>
<header>
  <div class="title">
    <h1>DS Computer Resume Builder</h1>
    <p>A4 Print/PDF perfect • Multi-page • Custom sections • Templates full-page</p>
  </div>
  <div class="btns">
    <button class="secondary" id="btnReset">Reset</button>
    <button class="secondary" id="btnPrint">Print / Save as PDF</button>
    <button id="btnPdf">Download PDF</button>
  </div>
</header>

<div class="wrap">
  <!-- LEFT -->
  <div class="panel">
    <div class="head">
      <b>Resume Details</b>
      <span class="hint">Template → full-page; Target pages → 1–4</span>
    </div>

    <div class="body">
      <div class="grid2">
        <div>
          <label>Template Style (8)</label>
          <select id="styleSelect">
            <option value="">-- Select Template Style --</option>
            <optgroup label="A: Minimal (2)">
              <option value="A1">A1 Minimal Center</option>
              <option value="A2">A2 Minimal Wide</option>
            </optgroup>
            <optgroup label="B: Blue Bars (2)">
              <option value="B1">B1 Blue Bar Classic</option>
              <option value="B2">B2 Blue Bar Strong</option>
            </optgroup>
            <optgroup label="C: Gray Professional (2)">
              <option value="C1">C1 Gray Competencies</option>
              <option value="C2">C2 Gray Balanced</option>
            </optgroup>
            <optgroup label="D: Classic Box (2)">
              <option value="D1">D1 Classic Box</option>
              <option value="D2">D2 Classic Two Page</option>
            </optgroup>
          </select>
        </div>
        <div>
          <label>Target Pages</label>
          <select id="targetPages">
            <option value="1">1 Page</option>
            <option value="2">2 Pages</option>
            <option value="3">3 Pages</option>
            <option value="4">4 Pages</option>
          </select>
          <div class="row" style="margin-top:8px">
            <input type="checkbox" id="autoFillPages" checked />
            <span class="hint">Auto-fill to target pages (template mode)</span>
          </div>
        </div>
      </div>

      <label>Show / Hide Sections</label>
      <div class="chipbox" id="sectionToggles"></div>

      <div class="divider"></div>

      <div class="grid2">
        <div>
          <label>Full Name</label>
          <input id="fullName" placeholder="Your full name" value="" />
        </div>
        <div>
          <label>Professional Title</label>
          <input id="jobTitle" placeholder="e.g., Accountant / Web Developer" value="" />
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Mobile</label>
          <input id="mobile" placeholder="Mobile number" value="" />
        </div>
        <div>
          <label>Email</label>
          <input id="email" placeholder="Email address" value="" />
        </div>
      </div>

      <label>LinkedIn / Website (optional)</label>
      <input id="link" placeholder="linkedin.com/in/..." value="" />

      <div class="grid2">
        <div>
          <label>Permanent Address</label>
          <textarea id="addrPermanent" placeholder="Type address here..."></textarea>
        </div>
        <div>
          <label>Temporary Address</label>
          <textarea id="addrTemp" placeholder="Type address here..."></textarea>
          <div class="row" style="margin-top:8px">
            <input type="checkbox" id="sameAddr" />
            <span class="hint">Same as Permanent</span>
          </div>
        </div>
      </div>

      <label>Summary / Objective</label>
      <textarea id="summary" placeholder="Write summary..."></textarea>

      <div class="grid2">
        <div>
          <label>Education (one item per line)</label>
          <textarea id="education" placeholder="e.g. BCA - 2022-2025 - College - %"></textarea>
        </div>
        <div>
          <label>Experience (one item per line)</label>
          <textarea id="experience" placeholder="e.g. 2021-2024: Company - Role - Work"></textarea>
        </div>
      </div>

      <label>Projects / Achievements (one per line)</label>
      <textarea id="projects" placeholder="e.g. Built Excel report system..."></textarea>

      <div class="grid2">
        <div>
          <label>Skills (comma separated)</label>
          <textarea id="skills" placeholder="Excel, Tally, Communication..."></textarea>
        </div>
        <div>
          <label>Core Competencies (comma separated)</label>
          <textarea id="competencies" placeholder="Operations, Reporting, Team handling..."></textarea>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Certifications (one per line)</label>
          <textarea id="certs" placeholder="e.g. Tally + GST - Institute"></textarea>
        </div>
        <div>
          <label>Training / Internship (one per line)</label>
          <textarea id="training" placeholder="e.g. Internship - Company - Duration - Work"></textarea>
        </div>
      </div>

      <div class="grid3">
        <div>
          <label>Languages</label>
          <input id="langs" placeholder="Hindi, English, Gujarati" value="" />
        </div>
        <div>
          <label>Hobbies</label>
          <input id="hobbies" placeholder="Reading, Sports..." value="" />
        </div>
        <div>
          <label>Declaration</label>
          <input id="declare" placeholder="Optional declaration line" value="" />
        </div>
      </div>

      <label>Personal Details</label>
      <div class="grid2">
        <div><input id="fatherName" placeholder="Father's Name" value="" /></div>
        <div><input id="dob" placeholder="Date of Birth (DD/MM/YYYY)" value="" /></div>
      </div>
      <div class="grid3">
        <div><input id="gender" placeholder="Gender" value="" /></div>
        <div><input id="marital" placeholder="Marital Status" value="" /></div>
        <div><input id="nationality" placeholder="Nationality" value="" /></div>
      </div>

      <div class="divider"></div>

      <div class="row" style="justify-content:space-between;align-items:center">
        <b style="font-size:13px">Custom Sections (User can add)</b>
        <button class="secondary" id="addSectionBtn" type="button">+ Add Section</button>
      </div>
      <div id="customSections"></div>

      <div class="hint" style="margin-top:12px">
        Print tip: Chrome → Ctrl+P → Save as PDF → Margins: None → Scale: Default
      </div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="previewWrap">
    <div class="pages" id="pages"></div>
  </div>
</div>

<script>
  const $ = (id)=>document.getElementById(id);

  const SECTION_KEYS = [
    {key:"summary", label:"Summary / Objective"},
    {key:"address", label:"Address"},
    {key:"personal", label:"Personal Details (Only 1st page)"},
    {key:"education", label:"Education"},
    {key:"experience", label:"Work Experience"},
    {key:"projects", label:"Projects / Achievements"},
    {key:"skills", label:"Skills"},
    {key:"competencies", label:"Core Competencies"},
    {key:"certs", label:"Certifications"},
    {key:"training", label:"Training / Internship"},
    {key:"languages", label:"Languages"},
    {key:"hobbies", label:"Hobbies"},
    {key:"declaration", label:"Declaration"},
    {key:"custom", label:"Custom Sections"}
  ];
  const sectionState = {
    summary:true,address:true,personal:true,education:true,experience:true,projects:true,
    skills:true,competencies:true,certs:true,training:true,languages:true,hobbies:true,declaration:true,custom:true
  };

  const state = {
    templateMode: false,
    style: "",
    targetPages: 1,
    autoFillPages: true,
    customSections: [] // {id, title, type, content}
  };

  function escapeHtml(str){
    return String(str || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function safeLines(text){
    return (text||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  }
  function safeCSV(text){
    return (text||"").split(",").map(s=>s.trim()).filter(Boolean);
  }

  // --- UI: section toggles
  function initSectionToggles(){
    const box = $("sectionToggles");
    box.innerHTML = "";
    SECTION_KEYS.forEach(item=>{
      const wrap = document.createElement("label");
      wrap.className = "chip";
      wrap.innerHTML = `
        <input type="checkbox" data-key="${item.key}" ${sectionState[item.key] ? "checked" : ""}/>
        <span>${item.label}</span>
      `;
      box.appendChild(wrap);
    });
    box.addEventListener("change",(e)=>{
      const t = e.target;
      if(t && t.matches("input[type='checkbox'][data-key]")){
        sectionState[t.dataset.key] = t.checked;
        render();
      }
    });
  }

  // --- Custom sections manager
  function addCustomSection(prefill){
    const id = "cs_" + Math.random().toString(16).slice(2);
    state.customSections.push({
      id,
      title: (prefill && prefill.title) || "Additional Section",
      type: (prefill && prefill.type) || "bullets", // bullets | paragraph
      content: (prefill && prefill.content) || ""
    });
    drawCustomSectionsUI();
    render();
  }

  function drawCustomSectionsUI(){
    const wrap = $("customSections");
    wrap.innerHTML = "";
    state.customSections.forEach((s, idx)=>{
      const card = document.createElement("div");
      card.className = "secCard";
      card.innerHTML = `
        <div class="top">
          <b>Section ${idx+1}</b>
          <div class="row">
            <button class="secondary miniBtn" type="button" data-up="${s.id}">Up</button>
            <button class="secondary miniBtn" type="button" data-down="${s.id}">Down</button>
            <button class="danger miniBtn" type="button" data-del="${s.id}">Delete</button>
          </div>
        </div>
        <label>Title</label>
        <input data-title="${s.id}" value="${escapeHtml(s.title)}" />
        <label>Type</label>
        <select data-type="${s.id}">
          <option value="bullets" ${s.type==="bullets"?"selected":""}>Bullets</option>
          <option value="paragraph" ${s.type==="paragraph"?"selected":""}>Paragraph</option>
        </select>
        <label>Content</label>
        <textarea data-content="${s.id}" placeholder="Write content...">${escapeHtml(s.content)}</textarea>
      `;
      wrap.appendChild(card);
    });

    wrap.querySelectorAll("input[data-title]").forEach(el=>{
      el.addEventListener("input", ()=>{
        const id = el.getAttribute("data-title");
        const s = state.customSections.find(x=>x.id===id);
        if(s){ s.title = el.value; render(); }
      });
    });
    wrap.querySelectorAll("select[data-type]").forEach(el=>{
      el.addEventListener("change", ()=>{
        const id = el.getAttribute("data-type");
        const s = state.customSections.find(x=>x.id===id);
        if(s){ s.type = el.value; render(); }
      });
    });
    wrap.querySelectorAll("textarea[data-content]").forEach(el=>{
      el.addEventListener("input", ()=>{
        const id = el.getAttribute("data-content");
        const s = state.customSections.find(x=>x.id===id);
        if(s){ s.content = el.value; render(); }
      });
    });

    wrap.querySelectorAll("button[data-del]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-del");
        state.customSections = state.customSections.filter(x=>x.id!==id);
        drawCustomSectionsUI(); render();
      });
    });
    wrap.querySelectorAll("button[data-up]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-up");
        const i = state.customSections.findIndex(x=>x.id===id);
        if(i>0){
          const tmp = state.customSections[i-1];
          state.customSections[i-1] = state.customSections[i];
          state.customSections[i] = tmp;
          drawCustomSectionsUI(); render();
        }
      });
    });
    wrap.querySelectorAll("button[data-down]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-down");
        const i = state.customSections.findIndex(x=>x.id===id);
        if(i>=0 && i<state.customSections.length-1){
          const tmp = state.customSections[i+1];
          state.customSections[i+1] = state.customSections[i];
          state.customSections[i] = tmp;
          drawCustomSectionsUI(); render();
        }
      });
    });
  }

  // --- Templates: (full-page & multi-page content packs)
  // NOTE: Personal fields (name/mobile/email) never forced.
  function templatePack(style, pages){
    // packs are made “realistic” and non-AI sounding; just clean, professional sample lines.
    const base = {
      jobTitle: "Professional Title",
      summary: "Write a short professional summary highlighting your role, strengths, and key experience.",
      education: [
        "Degree / Course - College/University - Year",
        "12th - Board - Year",
        "10th - Board - Year"
      ],
      experience: [
        "Company Name - Role | Year–Year: Key responsibility (reporting, coordination, documentation)",
        "Company Name - Role | Year–Year: Key responsibility (client handling, follow-ups, records)"
      ],
      projects: [
        "Project/Work: Reporting format creation and weekly summary preparation",
        "Project/Work: Documentation, email communication, and file management system"
      ],
      skills: "MS Office, Excel, Email, Documentation, Typing, Communication",
      competencies: "Reporting, Coordination, Record Management, Problem Solving, Time Management",
      certs: [
        "Course/Certificate - Institute - Year",
        "Course/Certificate - Institute - Year"
      ],
      training: [
        "Training/Internship - Organization - Duration - Work handled"
      ],
      langs: "Hindi, English, Gujarati",
      hobbies: "Reading, Learning new skills",
      declare: "I declare that the above information is true to the best of my knowledge."
    };

    // Expand content by pages
    const long2 = {
      summary: "Results-focused professional with experience in documentation, reporting, coordination, and daily operations support. Strong in Excel-based reports, accurate record maintenance, and clear communication. Comfortable with deadlines, follow-ups, and structured work.",
      experience: [
        "Company Name - Senior Role | Year–Present: Manage daily operations support, reporting, and coordination with teams.",
        "Company Name - Role | Year–Year: Prepare Excel reports, maintain records, verify entries, and handle documentation.",
        "Company Name - Role | Year–Year: Customer coordination, follow-ups, email updates, and file management."
      ],
      projects: [
        "Created weekly/monthly reporting formats and improved documentation flow.",
        "Managed client/service logs and ensured timely updates to stakeholders.",
        "Built simple Excel trackers for attendance, inventory, or billing support."
      ],
      certs: [
        "Advanced Excel - Institute - Year",
        "Tally/GST Basics - Institute - Year",
        "Typing / Computer Operator - Institute - Year"
      ],
      training: [
        "Professional training - Duration - Focus: reporting, documentation, coordination",
        "Internship/On-job training - Duration - Work: data handling & verification"
      ],
      competencies: "Operations Support, Reporting, Documentation, Coordination, Communication, Accuracy"
    };

    const long3 = {
      experience: [
        "Company Name - Role | Year–Present: Lead reporting, documentation flow, and team coordination for daily operations.",
        "Company Name - Role | Year–Year: Maintain files, registers, customer updates, and structured follow-ups.",
        "Company Name - Role | Year–Year: Handle data verification, entry accuracy, and weekly reporting.",
        "Company Name - Role | Year–Year: Support billing/records and maintain daily/weekly registers."
      ],
      projects: [
        "Standardized reporting formats to reduce errors and improve delivery time.",
        "Prepared compliance-ready documentation sets and maintained record accuracy.",
        "Built trackers for workflow updates, follow-ups, and approvals.",
        "Created templates for letters, forms, and official documentation."
      ],
      education: [
        "Degree / Course - College/University - Year - (optional %",
        "Diploma/Certification - Institute - Year",
        "12th - Board - Year",
        "10th - Board - Year"
      ],
      certs: [
        "Advanced Excel + MIS Reporting - Institute - Year",
        "Tally Prime / Accounting - Institute - Year",
        "Soft Skills / Communication - Institute - Year",
        "Computer Operator/Office Automation - Institute - Year"
      ],
      competencies: "Leadership Support, MIS Reporting, Operations, Process Improvement, Team Coordination, Accuracy"
    };

    const long4 = {
      projects: [
        "Process improvement: redesigned report formats and reduced manual errors.",
        "Operations reporting: created weekly/monthly dashboards for leadership updates.",
        "Documentation system: arranged records and introduced naming standards.",
        "Client support: maintained call/email logs and ensured timely follow-ups.",
        "Training support: created handouts/notes and supported junior staff."
      ],
      training: [
        "Leadership support training - Duration - Focus: reporting & coordination",
        "Operations training - Duration - Focus: process, documentation, workflow",
        "Quality & accuracy training - Duration - Focus: verification & compliance"
      ],
      competencies: "Process Improvement, MIS, Documentation, Compliance Support, Coordination, Stakeholder Handling"
    };

    // Style-specific titles
    const styleTitleMap = {
      A1:"Professional Resume", A2:"Professional Resume",
      B1:"Professional Summary", B2:"Professional Summary",
      C1:"Profile Summary", C2:"Profile Summary",
      D1:"Objectives", D2:"Objectives"
    };

    // Merge based on pages
    let pack = {...base};
    if(pages>=2) pack = deepMerge(pack, long2);
    if(pages>=3) pack = deepMerge(pack, long3);
    if(pages>=4) pack = deepMerge(pack, long4);

    // Slight style tweaks
    if(style.startsWith("B")){
      pack.jobTitle = "Web Developer / Software Role";
      pack.skills = "Front-end, Back-end basics, Source control, Communication, Documentation";
      pack.competencies = "Web Development, Architecture basics, Agile, Testing basics, Performance";
    }
    if(style.startsWith("C")){
      pack.jobTitle = "Operations / Manager Role";
      pack.competencies = "Operations, KPIs, Stakeholder handling, Cost reduction, Process management";
    }
    if(style.startsWith("D")){
      pack.jobTitle = "Student / Fresher Resume";
      pack.summary = "To obtain a responsible position where I can utilize my skills and contribute to organizational growth while improving my knowledge and work experience.";
    }

    pack._styleTitle = styleTitleMap[style] || "Summary";
    return pack;
  }

  function deepMerge(a,b){
    const out = {...a};
    Object.keys(b||{}).forEach(k=>{
      if(Array.isArray(b[k])) out[k] = b[k].slice();
      else if(typeof b[k]==="object" && b[k] && typeof a[k]==="object") out[k]=deepMerge(a[k],b[k]);
      else out[k]=b[k];
    });
    return out;
  }

  // --- Apply selected template
  function applyTemplate(){
    const style = $("styleSelect").value;
    if(!style) return;
    state.style = style;
    state.templateMode = true;

    const pages = parseInt($("targetPages").value,10) || 1;
    state.targetPages = pages;
    state.autoFillPages = $("autoFillPages").checked;

    const pack = templatePack(style, pages);

    // fill only professional fields (NOT personal identity)
    $("jobTitle").value = pack.jobTitle || "";
    $("summary").value = pack.summary || "";
    $("education").value = (pack.education||[]).join("\n");
    $("experience").value = (pack.experience||[]).join("\n");
    $("projects").value = (pack.projects||[]).join("\n");
    $("skills").value = pack.skills || "";
    $("competencies").value = pack.competencies || "";
    $("certs").value = (pack.certs||[]).join("\n");
    $("training").value = (pack.training||[]).join("\n");
    $("langs").value = pack.langs || "";
    $("hobbies").value = pack.hobbies || "";
    $("declare").value = pack.declare || "";

    // Add 1-2 custom sections in template mode for fuller pages
    state.customSections = [];
    if(pages>=2){
      addCustomSection({title:"Areas of Expertise", type:"bullets", content:
`• Reporting & documentation
• Team coordination & follow-ups
• Excel trackers & summaries
• Record maintenance & accuracy`});
    }
    if(pages>=3){
      addCustomSection({title:"Additional Information", type:"bullets", content:
`• Willing to relocate (if required)
• Comfortable with deadlines and routine reporting
• Open to learning new systems and tools`});
    }
    if(pages>=4){
      addCustomSection({title:"Key Highlights", type:"bullets", content:
`• Improved reporting format and reduced errors
• Maintained structured records and timely updates
• Supported workflow coordination across teams`});
    }

    drawCustomSectionsUI();
    render();
  }

  // --- Build section blocks with style
  function sectionTitleHtml(style, title){
    if(style.startsWith("A")){
      return `<div class="h3">${escapeHtml(title)}</div>`;
    }
    if(style.startsWith("B")){
      return `<div class="bar">${escapeHtml(title)}</div>`;
    }
    if(style.startsWith("C")){
      return `<div class="h3">${escapeHtml(title)}</div>`;
    }
    if(style.startsWith("D")){
      return `<div class="boxH">${escapeHtml(title)}</div>`;
    }
    return `<div class="h3">${escapeHtml(title)}</div>`;
  }

  function buildBlocks(data){
    const blocks = [];
    const style = data.style || "A1";
    const rootClass = style.startsWith("A") ? "styleA" : style.startsWith("B") ? "styleB" : style.startsWith("C") ? "styleC" : "styleD";

    // Header (ONLY ON FIRST PAGE; block appears once)
    blocks.push(`
      <div class="block ${rootClass}">
        <div class="r-hdr">
          <div>
            <h2 class="r-name">${escapeHtml(data.fullName || "FULL NAME")}</h2>
            ${data.jobTitle ? `<div class="r-role">${escapeHtml(data.jobTitle)}</div>` : ``}
          </div>
          <div class="r-contact">
            ${data.mobile ? `<div>${escapeHtml(data.mobile)}</div>` : ``}
            ${data.email ? `<div>${escapeHtml(data.email)}</div>` : ``}
            ${data.link ? `<div>${escapeHtml(data.link)}</div>` : ``}
            ${data.addrPermanent ? `<div style="margin-top:6px">${escapeHtml(data.addrPermanent)}</div>` : ``}
          </div>
        </div>
        ${style.startsWith("A") ? `<div class="topLine"></div>` : style.startsWith("C") ? `<div class="headRule"></div>` : style.startsWith("D") ? `<div class="thin"></div>` : ``}
      </div>
    `);

    // Summary
    if(sectionState.summary && data.summary){
      blocks.push(`
        <div class="block ${rootClass}">
          ${sectionTitleHtml(style, style.startsWith("D") ? "Objectives" : "Summary")}
          <div class="${style.startsWith("C") ? "shade" : ""}">
            <p>${escapeHtml(data.summary)}</p>
          </div>
          ${style.startsWith("A") ? `<div class="rule"></div>` : ``}
        </div>
      `);
    }

    // Personal details (still only once, not per page)
    if(sectionState.personal){
      const pd = [];
      if(data.fatherName) pd.push(["Father's Name", data.fatherName]);
      if(data.dob) pd.push(["Date of Birth", data.dob]);
      if(data.gender) pd.push(["Gender", data.gender]);
      if(data.marital) pd.push(["Marital Status", data.marital]);
      if(data.nationality) pd.push(["Nationality", data.nationality]);

      if(pd.length){
        blocks.push(`
          <div class="block ${rootClass}">
            ${sectionTitleHtml(style, "Personal Details")}
            <div class="${style.startsWith("C") ? "shade" : ""}">
              <div class="kv">
                ${pd.map(([k,v])=>`<b>${escapeHtml(k)}</b><div>${escapeHtml(v)}</div>`).join("")}
              </div>
            </div>
            ${style.startsWith("A") ? `<div class="rule"></div>` : ``}
          </div>
        `);
      }
    }

    const edu = safeLines(data.education);
    const exp = safeLines(data.experience);
    const proj = safeLines(data.projects);
    const certs = safeLines(data.certs);
    const training = safeLines(data.training);

    const skills = safeCSV(data.skills);
    const comps = safeCSV(data.competencies);
    const langs = safeCSV(data.langs);
    const hobbies = safeCSV(data.hobbies);

    const left = [];
    const right = [];

    if(sectionState.education && edu.length){
      left.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Education")}
          <ul>${edu.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
        </div>
      `);
    }

    if(sectionState.experience && exp.length){
      left.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Work Experience")}
          <ul>${exp.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
        </div>
      `);
    }

    if(sectionState.projects && proj.length){
      left.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Projects / Achievements")}
          <ul>${proj.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
        </div>
      `);
    }

    if(sectionState.certs && certs.length){
      left.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Certifications")}
          <ul>${certs.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
        </div>
      `);
    }

    if(sectionState.training && training.length){
      left.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Training / Internship")}
          <ul>${training.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
        </div>
      `);
    }

    if(sectionState.skills && skills.length){
      right.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Skills")}
          <div class="pillRow">${skills.map(x=>`<span class="pill">${escapeHtml(x)}</span>`).join("")}</div>
        </div>
      `);
    }

    if(sectionState.competencies && comps.length){
      const block = style.startsWith("C") ? "shade" : "";
      right.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Core Competencies")}
          <div class="${block}">
            <p>${comps.map(escapeHtml).join(" • ")}</p>
          </div>
        </div>
      `);
    }

    if(sectionState.languages && langs.length){
      right.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Languages")}
          <p>${langs.map(escapeHtml).join(", ")}</p>
        </div>
      `);
    }

    if(sectionState.hobbies && hobbies.length){
      right.push(`
        <div class="section">
          ${sectionTitleHtml(style, "Hobbies")}
          <p>${hobbies.map(escapeHtml).join(", ")}</p>
        </div>
      `);
    }

    if(left.length || right.length){
      blocks.push(`
        <div class="block ${ (style.startsWith("A")?"styleA":style.startsWith("B")?"styleB":style.startsWith("C")?"styleC":"styleD") }">
          <div class="twoCol">
            <div>${left.join("")}</div>
            <div>${right.join("")}</div>
          </div>
        </div>
      `);
    }

    // Custom sections
    if(sectionState.custom && state.customSections.length){
      state.customSections.forEach(sec=>{
        const lines = safeLines(sec.content);
        const isBullets = sec.type === "bullets";
        blocks.push(`
          <div class="block ${ (style.startsWith("A")?"styleA":style.startsWith("B")?"styleB":style.startsWith("C")?"styleC":"styleD") }">
            ${sectionTitleHtml(style, sec.title || "Section")}
            ${isBullets
              ? `<ul>${lines.map(x=>`<li>${escapeHtml(x.replace(/^•\s?/,""))}</li>`).join("")}</ul>`
              : `<p>${escapeHtml(sec.content)}</p>`
            }
          </div>
        `);
      });
    }

    // Declaration
    if(sectionState.declaration && data.declare){
      blocks.push(`
        <div class="block ${ (style.startsWith("A")?"styleA":style.startsWith("B")?"styleB":style.startsWith("C")?"styleC":"styleD") }">
          ${sectionTitleHtml(style, "Declaration")}
          <p>${escapeHtml(data.declare)}</p>
        </div>
      `);
    }

    return blocks;
  }

  // --- Pagination
  function newPage(){
    const page = document.createElement("div");
    page.className = "page";
    page.innerHTML = `<div class="content"></div>`;
    return page;
  }

  function render(){
    // same address
    if($("sameAddr").checked){
      $("addrTemp").value = $("addrPermanent").value;
      $("addrTemp").setAttribute("readonly","readonly");
      $("addrTemp").style.opacity="0.9";
    }else{
      $("addrTemp").removeAttribute("readonly");
      $("addrTemp").style.opacity="1";
    }

    const data = {
      style: state.style || $("styleSelect").value || "A1",
      fullName: $("fullName").value.trim(),
      jobTitle: $("jobTitle").value.trim(),
      mobile: $("mobile").value.trim(),
      email: $("email").value.trim(),
      link: $("link").value.trim(),
      addrPermanent: $("addrPermanent").value.trim(),
      summary: $("summary").value.trim(),
      education: $("education").value,
      experience: $("experience").value,
      projects: $("projects").value,
      skills: $("skills").value,
      competencies: $("competencies").value,
      certs: $("certs").value,
      training: $("training").value,
      langs: $("langs").value.trim(),
      hobbies: $("hobbies").value.trim(),
      declare: $("declare").value.trim(),
      fatherName: $("fatherName").value.trim(),
      dob: $("dob").value.trim(),
      gender: $("gender").value.trim(),
      marital: $("marital").value.trim(),
      nationality: $("nationality").value.trim()
    };

    const pagesEl = $("pages");
    pagesEl.innerHTML = "";

    let page = newPage();
    pagesEl.appendChild(page);
    let contentEl = page.querySelector(".content");
    let maxH = contentEl.clientHeight;

    const blocks = buildBlocks(data).map(html=>{
      const div = document.createElement("div");
      div.innerHTML = html.trim();
      return div.firstElementChild;
    });

    for(const block of blocks){
      contentEl.appendChild(block);
      if(contentEl.scrollHeight > maxH + 2){
        contentEl.removeChild(block);
        page = newPage();
        pagesEl.appendChild(page);
        contentEl = page.querySelector(".content");
        maxH = contentEl.clientHeight;
        contentEl.appendChild(block);
      }
    }

    // If template mode + autoFillPages → ensure pages count >= target
    if(state.templateMode && $("autoFillPages").checked){
      const target = parseInt($("targetPages").value,10) || 1;
      while(pagesEl.children.length < target){
        // add extra filler section (professional, not AI-sounding)
        addCustomSection({
          title: "Additional Points",
          type: "bullets",
          content: `• Responsible and punctual work style
• Comfortable with structured reporting
• Good coordination and follow-up habits
• Ready to learn new systems/tools`
        });
        // re-render once after adding (break loop naturally)
        // (render is called by addCustomSection)
        break;
      }
    }
  }

  // --- Bind inputs
  function bindAutoRender(){
    const ids = [
      "fullName","jobTitle","mobile","email","link",
      "addrPermanent","addrTemp","sameAddr",
      "summary","education","experience","projects",
      "skills","competencies","certs","training",
      "langs","hobbies","declare",
      "fatherName","dob","gender","marital","nationality"
    ];
    ids.forEach(id=>{
      const el = $(id);
      el.addEventListener("input", render);
      el.addEventListener("change", render);
    });
  }

  // Buttons
  $("btnPrint").addEventListener("click", ()=>window.print());
  $("btnPdf").addEventListener("click", async ()=>{
    const element = document.getElementById("pages");
    const opt = {
      margin: 0,
      filename: 'resume.pdf',
      image: { type:'jpeg', quality:0.98 },
      html2canvas: { scale:2, useCORS:true },
      jsPDF: { unit:'mm', format:'a4', orientation:'portrait' },
      pagebreak: { mode:['css','legacy'] }
    };
    await html2pdf().set(opt).from(element).save();
  });

  $("btnReset").addEventListener("click", ()=>{
    if(confirm("Reset all fields?")){
      location.reload();
    }
  });

  $("addSectionBtn").addEventListener("click", ()=>addCustomSection());

  // Template controls
  $("styleSelect").addEventListener("change", applyTemplate);
  $("targetPages").addEventListener("change", ()=>{
    if($("styleSelect").value) applyTemplate();
    else render();
  });
  $("autoFillPages").addEventListener("change", ()=>{
    state.autoFillPages = $("autoFillPages").checked;
    render();
  });

  // Init
  initSectionToggles();
  bindAutoRender();
  drawCustomSectionsUI();
  render();
</script>
</body>
</html>
